THREE.Binder={bind:function(u,d){return function(e,t){t.__binds||(t.__binds=[]);var n=u;_.isArray(e)&&(n=e[0],e=e[1]);for(var i=/^([^.:]*(?:\.[^.:]+)*)?(?:\:(.*))?$/.exec(e),o=i[1].split(/\./g),s=o.pop(),a=i[2]||s,r=o.shift(),c={this:t}[r]||d[r]||u[r]||n;c&&(e=o.shift());)c=c[e];if(c&&(c.on||c.addEventListener)){function l(e){t[a]&&t[a](e,u)}THREE.Binder._polyfill(c,["addEventListener","on"],function(e){c[e](s,l)});var h={target:c,name:s,callback:l};return t.__binds.push(h),l}throw"Cannot bind '"+e+"' in "+this.__name}},unbind:function(){return function(e){e.__binds&&(e.__binds.forEach(function(t){THREE.Binder._polyfill(t.target,["removeEventListener","off"],function(e){t.target[e](t.name,t.callback)})}.bind(this)),e.__binds=[])}},apply:function(e){Object.assign(e,THREE.EventDispatcher.prototype),e.trigger=THREE.Binder._trigger,e.triggerOnce=THREE.Binder._triggerOnce,e.on=e.addEventListener,e.off=e.removeEventListener,e.dispatchEvent=e.trigger},_triggerOnce:function(e){this.trigger(e),this._listeners&&delete this._listeners[e.type]},_trigger:function(e){if(void 0!==this._listeners){var t=e.type,n=this._listeners[t];if(void 0!==n){var i=(n=n.slice()).length;e.target=this;for(var o=0;o<i;o++)n[o].call(this,e,this)}}},_polyfill:function(t,e,n){e.map(function(e){return t.method}),e.length&&n(e[0])}},THREE.Api={apply:function(e){e.set=function(e){var i=this.options||{},t=_.reduce(e,function(e,t,n){return i[n]!==t&&(e[n]=t),e},{});this.options=_.extend(i,t),this.trigger({type:"change",options:e,changes:t})},e.get=function(){return this.options},e.api=function(e,i){return e=e||{},i&&_.each(e,function(e,t,n){_.isFunction(e)&&(n[t]=_.partialRight(e,i))}),e.set=this.set.bind(this),e.get=this.get.bind(this),e}}},THREE.Bootstrap=function(e){if(e){var t=[].slice.apply(arguments);e={},t[0]instanceof Node&&(node=t[0],t=t.slice(1),e.element=node),_.isString(t[0])&&(e.plugins=t),_.isArray(t[0])&&(e.plugins=t[0]),t[0]&&(e=_.defaults(e,t[0]))}if(!(this instanceof THREE.Bootstrap))return new THREE.Bootstrap(e);var n={init:!0,element:document.body,plugins:["core"],aliases:{},plugindb:THREE.Bootstrap.Plugins||{},aliasdb:THREE.Bootstrap.Aliases||{}};this.__options=_.defaults(e||{},n),this.__inited=!1,this.__destroyed=!1,this.__installed=[];var i=this.__options.element;i===""+i&&(i=document.querySelector(i)),this.plugins={},this.element=i,this.trigger=this.trigger.bind(this),this.frame=this.frame.bind(this),this.events=["pre","update","render","post"].map(function(e){return{type:e}}),this.__options.init&&this.init()},THREE.Bootstrap.prototype={init:function(){if(!this.__inited)return this.__inited=!0,this.install(this.__options.plugins),this},destroy:function(){if(this.__inited&&!this.__destroyed)return this.__destroyed=!0,this.trigger({type:"destroy"}),this.uninstall(),this},frame:function(){this.events.map(this.trigger)},resolve:function(e){e=_.isArray(e)?e:[e];var t=this.__options,s=_.extend({},t.aliasdb,t.aliases),a=function(e){var t=e.split(":");return!t[1]||!(s[t[0]]=[t[1]])};return e=_.filter(e,a),_.each(s,function(e,t){s[t]=_.isArray(e)?e:[e]}),function n(e,i,o){if(256<=o)throw"Plug-in alias recursion detected.";return e=_.filter(e,a),_.each(e,function(e){var t=s[e];t?i=i.concat(n(t,[],o+1)):i.push(e)}),i}(e,[],0)},install:function(e){e=_.isArray(e)?e:[e],e=this.resolve(e),_.each(e,this.__install,this),this.__ready()},uninstall:function(e){e&&(e=_.isArray(e)?e:[e],e=this.resolve(e)),_.eachRight(e||this.__installed,this.__uninstall,this)},__install:function(e){var t=this.__options.plugindb[e];if(!t)throw"[three.install] Cannot install. '"+e+"' is not registered.";if(this.plugins[e])return console.warn("[three.install] "+e+" is already installed.");var n=new t(this.__options[e]||{},e);return this.plugins[e]=n,flag=n.install(this),this.__installed.push(n),this.trigger({type:"install",plugin:n}),flag},__uninstall:function(e,t){if(plugin=_.isString(e)?this.plugins[e]:e,!plugin)return console.warn("[three.uninstall] "+e+"' is not installed.");e=plugin.__name,plugin.uninstall(this),this.__installed=_.without(this.__installed,plugin),delete this.plugins[e],this.trigger({type:"uninstall",plugin:plugin})},__ready:function(){this.triggerOnce({type:"ready"})}},THREE.Binder.apply(THREE.Bootstrap.prototype),THREE.Bootstrap.Plugins={},THREE.Bootstrap.Aliases={},THREE.Bootstrap.Plugin=function(e){this.options=_.defaults(e||{},this.defaults)},THREE.Bootstrap.Plugin.prototype={listen:[],defaults:{},install:function(e){},uninstall:function(e){}},THREE.Binder.apply(THREE.Bootstrap.Plugin.prototype),THREE.Api.apply(THREE.Bootstrap.Plugin.prototype),THREE.Bootstrap.registerPlugin=function(t,e){function n(e){THREE.Bootstrap.Plugin.call(this,e),this.__name=t}n.prototype=_.extend(new THREE.Bootstrap.Plugin,e),THREE.Bootstrap.Plugins[t]=n},THREE.Bootstrap.unregisterPlugin=function(e){delete THREE.Bootstrap.Plugins[e]},THREE.Bootstrap.registerAlias=function(e,t){THREE.Bootstrap.Aliases[e]=t},THREE.Bootstrap.unregisterAlias=function(e){delete THREE.Bootstrap.Aliases[e]},THREE.Bootstrap.registerAlias("empty",["fallback","bind","renderer","size","fill","loop","time"]),THREE.Bootstrap.registerAlias("core",["empty","scene","camera","render","warmup"]),THREE.Bootstrap.registerAlias("VR",["core","cursor","fullscreen","render:vr"]),THREE.Bootstrap.registerPlugin("fallback",{defaults:{force:!1,fill:!0,begin:'<div class="threestrap-fallback" style="display: table; width: 100%; height: 100%;box-sizing: border-box; border: 1px dashed rgba(0, 0, 0, .25);"><div style="display: table-cell; padding: 10px; vertical-align: middle; text-align: center;">',end:"</div></div>",message:'<big><strong>This example requires WebGL</strong></big><br>Visit <a target="_blank" href="http://get.webgl.org/">get.webgl.org</a> for more info</a>'},install:function(t){var e;try{if(e=document.createElement("canvas"),gl=e.getContext("webgl")||e.getContext("experimental-webgl"),!gl||this.options.force)throw"WebGL unavailable.";t.fallback=!1}catch(e){var n=this.options.message,i=this.options.begin,o=this.options.end,s=this.options.fill,a=document.createElement("div");for(a.innerHTML=i+n+o,this.children=[];0<a.childNodes.length;)this.children.push(a.firstChild),t.element.appendChild(a.firstChild);return s&&t.install("fill"),this.div=a,!(t.fallback=!0)}},uninstall:function(e){this.children&&(this.children.forEach(function(e){e.parentNode.removeChild(e)}),this.children=null),delete e.fallback}}),THREE.Bootstrap.registerPlugin("renderer",{defaults:{klass:THREE.WebGLRenderer,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0}},listen:["resize"],install:function(e){var t=e.renderer=new this.options.klass(this.options.parameters);e.canvas=t.domElement,e.element.appendChild(t.domElement)},uninstall:function(e){e.element.removeChild(e.renderer.domElement),delete e.renderer,delete e.canvas},resize:function(e,t){var n=t.renderer,i=n.domElement;i&&"CANVAS"==i.tagName?n.setSize(e.renderWidth,e.renderHeight,!1):(n.setRenderSize&&n.setRenderSize(e.renderWidth,e.renderHeight),n.setSize(e.viewWidth,e.viewHeight,!1))}}),THREE.Bootstrap.registerPlugin("bind",{install:function(e){var t={three:e,window:window};e.bind=THREE.Binder.bind(e,t),e.unbind=THREE.Binder.unbind(e),e.bind("install:bind",this),e.bind("uninstall:unbind",this)},uninstall:function(e){e.unbind(this),delete e.bind,delete e.unbind},bind:function(e,t){var n=e.plugin,i=n.listen;i&&i.forEach(function(e){t.bind(e,n)})},unbind:function(e,t){t.unbind(e.plugin)}}),THREE.Bootstrap.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,maxRenderWidth:1/0,maxRenderHeight:1/0,devicePixelRatio:!0},listen:["window.resize:queue","element.resize:queue","this.change:queue","ready:resize","pre:pre"],install:function(e){e.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0}),this.resized=!1},uninstall:function(e){delete e.Size},queue:function(e,t){this.resized=!0},pre:function(e,t){this.resized&&(this.resized=!1,this.resize(e,t))},resize:function(e,t){var n,i,o,s,a,r,c,l,h,u=this.options,d=t.element,p=t.renderer,m=0,E=0;c=(n=o=void 0===u.width||null==u.width?d.offsetWidth||d.innerWidth||0:u.width)/(i=s=void 0===u.height||null==u.height?d.offsetHeight||d.innerHeight||0:u.height),u.aspect&&(u.aspect>c?(i=Math.round(n/u.aspect),E=Math.floor((s-i)/2)):(n=Math.round(i*u.aspect),m=Math.floor((o-n)/2)),c=n/i),h=1,u.devicePixelRatio&&"undefined"!=typeof window&&(h=window.devicePixelRatio||1),a=Math.round(Math.min(n*h*u.scale,u.maxRenderWidth)),r=Math.round(Math.min(i*h*u.scale,u.maxRenderHeight)),raspect=a/r,raspect>c?a=Math.round(r*c):r=Math.round(a/c),h=r/i,(l=p.domElement.style).width=n+"px",l.height=i+"px",l.marginLeft=m+"px",l.marginTop=E+"px",_.extend(t.Size,{renderWidth:a,renderHeight:r,viewWidth:n,viewHeight:i,aspect:c,pixelRatio:h}),t.trigger({type:"resize",renderWidth:a,renderHeight:r,viewWidth:n,viewHeight:i,aspect:c,pixelRatio:h})}}),THREE.Bootstrap.registerPlugin("fill",{defaults:{block:!0,body:!0,layout:!0},install:function(e){this.options.body&&e.element==document.body&&(this.applied=[e.element,document.documentElement].filter(function(e){var t=e.style.height;return"auto"==t||""==t}).map(function(e){return e.style.height="100%",e.style.margin=0,e.style.padding=0,e})),this.options.block&&e.canvas&&(e.canvas.style.display="block",this.block=!0),this.options.layout&&e.element&&("static"==window.getComputedStyle(e.element).position&&(e.element.style.position="relative",this.layout=!0))},uninstall:function(e){if(this.applied){this.applied.map(function(e){return e.style.height="",e.style.margin="",e.style.padding="",e}),delete this.applied}this.block&&e.canvas&&(e.canvas.style.display="",delete this.block),this.layout&&e.element&&(e.element.style.position="",delete this.layout)},change:function(e){this.uninstall(e),this.install(e)}}),THREE.Bootstrap.registerPlugin("loop",{defaults:{start:!0,force:!0,rate:1,each:1},listen:["ready","window.resize:reset","dirty","post"],install:function(e){this.running=!1,this.pending=!1,this.lastRequestId=null,e.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1,window:window},e),this.frame=0},uninstall:function(e){this.stop(e)},ready:function(e,t){this.options.start&&this.start(t)},dirty:function(e,t){this.running||!this.options.force||this.pending||(this.reset(),this.start(),this.pending=!0)},post:function(e,t){this.pending=!1},reset:function(){this.frame=0},start:function(t){if(!this.running){t.Loop.running=this.running=!0;var n=t.trigger.bind(t),i=0,o=function(){if(this.running){this.lastRequestId=t.Loop.window.requestAnimationFrame(o),0==(i=(i+1)%Math.max(1,this.options.each))&&this.events.map(n);var e=this.options.rate;(e<=1||this.frame%e==0)&&t.frame(),this.frame++}}.bind(this);this.lastRequestId=t.Loop.window.requestAnimationFrame(o),t.trigger({type:"start"})}},stop:function(e){this.running&&(e.Loop.running=this.running=!1,e.Loop.window.cancelAnimationFrame(this.lastRequestId),this.lastRequestId=null,e.trigger({type:"stop"}))}}),THREE.Bootstrap.registerPlugin("time",{defaults:{speed:1,warmup:0,timeout:1},listen:["pre:tick","this.change"],now:function(){return+new Date/1e3},install:function(e){e.Time=this.api({now:this.now(),clock:0,step:1/60,frames:0,time:0,delta:1/60,average:0,fps:0}),this.last=0,this.time=0,this.clock=0,this.wait=this.options.warmup,this.clockStart=0,this.timeStart=0},tick:function(e,t){var n=this.options.speed,i=this.options.timeout,o=t.Time,s=o.now=this.now(),a=this.last,r=this.time,c=this.clock;if(a){var l=o.delta=s-a,h=o.average||l;i<l&&(l=0);var u=l*n;r+=l,c+=u,0<o.frames&&(o.average=h+.1*(l-h),o.fps=1/h),o.step=u,o.clock=c-this.clockStart,o.time=r-this.timeStart,o.frames++,0<this.wait--&&(this.clockStart=c,this.timeStart=r,o.clock=0,o.step=1e-100)}this.last=s,this.clock=c,this.time=r},uninstall:function(e){delete e.Time}}),THREE.Bootstrap.registerPlugin("scene",{install:function(e){e.scene=new THREE.Scene},uninstall:function(e){delete e.scene}}),THREE.Bootstrap.registerPlugin("camera",{defaults:{near:.01,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1,klass:null,parameters:null},listen:["resize","this.change"],install:function(e){e.Camera=this.api(),e.camera=null,this.aspect=1,this.change({},e)},uninstall:function(e){delete e.Camera,delete e.camera},change:function(e,n){var i=this.options,t=n.camera;if(!n.camera||e.changes.type||e.changes.klass){var o=i.klass||{perspective:THREE.PerspectiveCamera,orthographic:THREE.OrthographicCamera}[i.type]||THREE.Camera;n.camera=i.parameters?new o(i.parameters):new o}_.each(i,function(e,t){n.camera.hasOwnProperty(t)&&(n.camera[t]=i[t])}.bind(this)),this.update(n),t===n.camera||n.trigger({type:"camera",camera:n.camera})},resize:function(e,t){this.aspect=e.viewWidth/Math.max(1,e.viewHeight),this.update(t)},update:function(e){e.camera.aspect=this.options.aspect||this.aspect,e.camera.updateProjectionMatrix()}}),THREE.Bootstrap.registerPlugin("render",{listen:["render"],render:function(e,t){t.scene&&t.camera&&t.renderer.render(t.scene,t.camera)}}),THREE.Bootstrap.registerPlugin("warmup",{defaults:{delay:2},listen:["ready","post"],ready:function(e,t){t.renderer.domElement.style.visibility="hidden",this.frame=0,this.hidden=!0},post:function(e,t){this.hidden&&this.frame>=this.options.delay&&(t.renderer.domElement.style.visibility="visible",this.hidden=!1),this.frame++}});var Stats=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++n%i.children.length)},!1);var o=(performance||Date).now(),s=o,a=0,r=e(new Stats.Panel("FPS","#0ff","#002")),c=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new Stats.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-o,200),s+1e3<e&&(r.update(1e3*a/(e-s),100),s=e,a=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:t}};Stats.Panel=function(n,i,o){var s=1/0,a=0,r=Math.round,c=r(window.devicePixelRatio||1),l=80*c,e=48*c,h=3*c,u=2*c,d=3*c,p=15*c,m=74*c,E=30*c,f=document.createElement("canvas");f.width=l,f.height=e,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*c+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=o,g.fillRect(0,0,l,e),g.fillStyle=i,g.fillText(n,h,u),g.fillRect(d,p,m,E),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(d,p,m,E),{dom:f,update:function(e,t){s=Math.min(s,e),a=Math.max(a,e),g.fillStyle=o,g.globalAlpha=1,g.fillRect(0,0,l,p),g.fillStyle=i,g.fillText(r(e)+" "+n+" ("+r(s)+"-"+r(a)+")",h,u),g.drawImage(f,d+c,p,m-c,E,d,p,m-c,E),g.fillRect(d+m-c,p,c,E),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(d+m-c,p,c,r((1-e/t)*E))}}},"object"==typeof module&&(module.exports=Stats),THREE.DeviceOrientationControls=function(e){var s=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;function t(e){s.deviceOrientation=e}function n(){s.screenOrientation=window.orientation||0}var a,r,c,l,h=(a=new THREE.Vector3(0,0,1),r=new THREE.Euler,c=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,n,i,o){r.set(n,t,-i,"YXZ"),e.setFromEuler(r),e.multiply(l),e.multiply(c.setFromAxisAngle(a,-o))});this.connect=function(){n(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(function(e){"granted"==e&&(window.addEventListener("orientationchange",n,!1),window.addEventListener("deviceorientation",t,!1))}).catch(function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",n,!1),window.addEventListener("deviceorientation",t,!1)),s.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",n,!1),window.removeEventListener("deviceorientation",t,!1),s.enabled=!1},this.update=function(){if(!1!==s.enabled){var e=s.deviceOrientation;if(e){var t=e.alpha?THREE.MathUtils.degToRad(e.alpha)+s.alphaOffset:0,n=e.beta?THREE.MathUtils.degToRad(e.beta):0,i=e.gamma?THREE.MathUtils.degToRad(e.gamma):0,o=s.screenOrientation?THREE.MathUtils.degToRad(s.screenOrientation):0;h(s.object.quaternion,t,n,i,o)}}},this.dispose=function(){s.disconnect()},this.connect()},THREE.FirstPersonControls=function(e,t){void 0===t&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0;var c,l=this.viewHalfY=0,h=0,n=new THREE.Vector3,i=new THREE.Spherical,o=new THREE.Vector3;function s(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,n){return e.isVector3?o.copy(e):o.set(e,t,n),this.object.lookAt(o),E(this),this},this.update=(c=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var n=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.moveUp&&this.object.translateY(n),this.moveDown&&this.object.translateY(-n);var i=e*this.lookSpeed;this.activeLook||(i=0);var o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),h-=this.mouseX*i,this.lookVertical&&(l-=this.mouseY*i*o),l=Math.max(-85,Math.min(85,l));var s=THREE.MathUtils.degToRad(90-l),a=THREE.MathUtils.degToRad(h);this.constrainVertical&&(s=THREE.MathUtils.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));var r=this.object.position;c.setFromSphericalCoords(1,s,a).add(r),this.object.lookAt(c)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",s,!1),this.domElement.removeEventListener("mousedown",r,!1),this.domElement.removeEventListener("mousemove",a,!1),this.domElement.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",p,!1)};var a=m(this,this.onMouseMove),r=m(this,this.onMouseDown),u=m(this,this.onMouseUp),d=m(this,this.onKeyDown),p=m(this,this.onKeyUp);function m(e,t){return function(){t.apply(e,arguments)}}function E(e){var t=e.object.quaternion;n.set(0,0,-1).applyQuaternion(t),i.setFromVector3(n),l=90-THREE.MathUtils.radToDeg(i.phi),h=THREE.MathUtils.radToDeg(i.theta)}this.domElement.addEventListener("contextmenu",s,!1),this.domElement.addEventListener("mousemove",a,!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mouseup",u,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",p,!1),this.handleResize(),E(this)},THREE.OrbitControls=function(e,t){var n,i,o,s,a;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(c),r.update(),d=u.NONE},this.update=(n=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=i.clone().inverse(),s=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=r.object.position;return n.copy(e).sub(r.target),n.applyQuaternion(i),m.setFromVector3(n),r.autoRotate&&d===u.NONE&&_(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(m.theta+=E.theta*r.dampingFactor,m.phi+=E.phi*r.dampingFactor):(m.theta+=E.theta,m.phi+=E.phi),m.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,m.theta)),m.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=f,m.radius=Math.max(r.minDistance,Math.min(r.maxDistance,m.radius)),!0===r.enableDamping?r.target.addScaledVector(g,r.dampingFactor):r.target.add(g),n.setFromSpherical(m),n.applyQuaternion(o),e.copy(r.target).add(n),r.object.lookAt(r.target),!0===r.enableDamping?(E.theta*=1-r.dampingFactor,E.phi*=1-r.dampingFactor,g.multiplyScalar(1-r.dampingFactor)):(E.set(0,0,0),g.set(0,0,0)),f=1,!(!(v||s.distanceToSquared(r.object.position)>p||8*(1-a.dot(r.object.quaternion))>p)||(r.dispatchEvent(c),s.copy(r.object.position),a.copy(r.object.quaternion),v=!1))}),this.dispose=function(){r.domElement.removeEventListener("contextmenu",te,!1),r.domElement.removeEventListener("mousedown",Z,!1),r.domElement.removeEventListener("wheel",K,!1),r.domElement.removeEventListener("touchstart",J,!1),r.domElement.removeEventListener("touchend",ee,!1),r.domElement.removeEventListener("touchmove",$,!1),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",G,!1),r.domElement.removeEventListener("keydown",Q,!1)};var r=this,c={type:"change"},l={type:"start"},h={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=u.NONE,p=1e-6,m=new THREE.Spherical,E=new THREE.Spherical,f=1,g=new THREE.Vector3,v=!1,b=new THREE.Vector2,R=new THREE.Vector2,y=new THREE.Vector2,T=new THREE.Vector2,w=new THREE.Vector2,H=new THREE.Vector2,O=new THREE.Vector2,k=new THREE.Vector2,P=new THREE.Vector2;function L(){return Math.pow(.95,r.zoomSpeed)}function _(e){E.theta-=e}function M(e){E.phi-=e}var S,x,C,j=(S=new THREE.Vector3,function(e,t){S.setFromMatrixColumn(t,0),S.multiplyScalar(-e),g.add(S)}),V=(x=new THREE.Vector3,function(e,t){!0===r.screenSpacePanning?x.setFromMatrixColumn(t,1):(x.setFromMatrixColumn(t,0),x.crossVectors(r.object.up,x)),x.multiplyScalar(e),g.add(x)}),A=(C=new THREE.Vector3,function(e,t){var n=r.domElement;if(r.object.isPerspectiveCamera){var i=r.object.position;C.copy(i).sub(r.target);var o=C.length();o*=Math.tan(r.object.fov/2*Math.PI/180),j(2*e*o/n.clientHeight,r.object.matrix),V(2*t*o/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(j(e*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),V(t*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)});function D(e){r.object.isPerspectiveCamera?f/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function N(e){r.object.isPerspectiveCamera?f*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function z(e){b.set(e.clientX,e.clientY)}function F(e){T.set(e.clientX,e.clientY)}function Y(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}}function B(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,n)}}function U(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);O.set(0,i)}function X(e){if(1==e.touches.length)R.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);R.set(t,n)}y.subVectors(R,b).multiplyScalar(r.rotateSpeed);var i=r.domElement;_(2*Math.PI*y.x/i.clientHeight),M(2*Math.PI*y.y/i.clientHeight),b.copy(R)}function q(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}H.subVectors(w,T).multiplyScalar(r.panSpeed),A(H.x,H.y),T.copy(w)}function I(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);k.set(0,i),P.set(0,Math.pow(k.y/O.y,r.zoomSpeed)),D(P.y),O.copy(k)}function Z(e){if(!1!==r.enabled){var t;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){O.set(e.clientX,e.clientY)}(e),d=u.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;F(e),d=u.PAN}else{if(!1===r.enableRotate)return;z(e),d=u.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;z(e),d=u.ROTATE}else{if(!1===r.enablePan)return;F(e),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&(document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",G,!1),r.dispatchEvent(l))}}function W(e){if(!1!==r.enabled)switch(e.preventDefault(),d){case u.ROTATE:if(!1===r.enableRotate)return;!function(e){R.set(e.clientX,e.clientY),y.subVectors(R,b).multiplyScalar(r.rotateSpeed);var t=r.domElement;_(2*Math.PI*y.x/t.clientHeight),M(2*Math.PI*y.y/t.clientHeight),b.copy(R),r.update()}(e);break;case u.DOLLY:if(!1===r.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),P.subVectors(k,O),0<P.y?D(L()):P.y<0&&N(L()),O.copy(k),r.update()}(e);break;case u.PAN:if(!1===r.enablePan)return;!function(e){w.set(e.clientX,e.clientY),H.subVectors(w,T).multiplyScalar(r.panSpeed),A(H.x,H.y),T.copy(w),r.update()}(e)}}function G(e){!1!==r.enabled&&(document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",G,!1),r.dispatchEvent(h),d=u.NONE)}function K(e){!1===r.enabled||!1===r.enableZoom||d!==u.NONE&&d!==u.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(l),function(e){e.deltaY<0?N(L()):0<e.deltaY&&D(L()),r.update()}(e),r.dispatchEvent(h))}function Q(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){var t=!1;switch(e.keyCode){case r.keys.UP:A(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:A(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:A(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:A(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function J(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===r.enableRotate)return;Y(e),d=u.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===r.enablePan)return;B(e),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(r.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&U(e),r.enablePan&&B(e)}(e),d=u.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&U(e),r.enableRotate&&Y(e)}(e),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&r.dispatchEvent(l)}}function $(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case u.TOUCH_ROTATE:if(!1===r.enableRotate)return;X(e),r.update();break;case u.TOUCH_PAN:if(!1===r.enablePan)return;q(e),r.update();break;case u.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&I(e),r.enablePan&&q(e)}(e),r.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&I(e),r.enableRotate&&X(e)}(e),r.update();break;default:d=u.NONE}}function ee(e){!1!==r.enabled&&(r.dispatchEvent(h),d=u.NONE)}function te(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",te,!1),r.domElement.addEventListener("mousedown",Z,!1),r.domElement.addEventListener("wheel",K,!1),r.domElement.addEventListener("touchstart",J,!1),r.domElement.addEventListener("touchend",ee,!1),r.domElement.addEventListener("touchmove",$,!1),r.domElement.addEventListener("keydown",Q,!1),-1===r.domElement.tabIndex&&(r.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls,THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var s=this,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var n=new THREE.Vector3,i=1,r=a.NONE,o=a.NONE,c=new THREE.Vector3,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector3,d=0,p=new THREE.Vector2,m=new THREE.Vector2,E=0,f=0,g=new THREE.Vector2,v=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var b={type:"change"},R={type:"start"},y={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var T,w,H,O,k,P,L,_,M,S,x,C,j=(T=new THREE.Vector2,function(e,t){return T.set((e-s.screen.left)/s.screen.width,(t-s.screen.top)/s.screen.height),T}),V=(w=new THREE.Vector2,function(e,t){return w.set((e-.5*s.screen.width-s.screen.left)/(.5*s.screen.width),(s.screen.height+2*(s.screen.top-t))/s.screen.width),w});function A(e){!1!==s.enabled&&(window.removeEventListener("keydown",A),o===a.NONE&&(e.keyCode!==s.keys[a.ROTATE]||s.noRotate?e.keyCode!==s.keys[a.ZOOM]||s.noZoom?e.keyCode!==s.keys[a.PAN]||s.noPan||(o=a.PAN):o=a.ZOOM:o=a.ROTATE))}function D(){!1!==s.enabled&&(o=a.NONE,window.addEventListener("keydown",A,!1))}function N(e){if(!1!==s.enabled){if(e.preventDefault(),e.stopPropagation(),r===a.NONE)switch(e.button){case s.mouseButtons.LEFT:r=a.ROTATE;break;case s.mouseButtons.MIDDLE:r=a.ZOOM;break;case s.mouseButtons.RIGHT:r=a.PAN;break;default:r=a.NONE}var t=o!==a.NONE?o:r;t!==a.ROTATE||s.noRotate?t!==a.ZOOM||s.noZoom?t!==a.PAN||s.noPan||(g.copy(j(e.pageX,e.pageY)),v.copy(g)):(p.copy(j(e.pageX,e.pageY)),m.copy(p)):(h.copy(V(e.pageX,e.pageY)),l.copy(h)),document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",F,!1),s.dispatchEvent(R)}}function z(e){if(!1!==s.enabled){e.preventDefault(),e.stopPropagation();var t=o!==a.NONE?o:r;t!==a.ROTATE||s.noRotate?t!==a.ZOOM||s.noZoom?t!==a.PAN||s.noPan||v.copy(j(e.pageX,e.pageY)):m.copy(j(e.pageX,e.pageY)):(l.copy(h),h.copy(V(e.pageX,e.pageY)))}}function F(e){!1!==s.enabled&&(e.preventDefault(),e.stopPropagation(),r=a.NONE,document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",F),s.dispatchEvent(y))}function Y(e){if(!1!==s.enabled&&!0!==s.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:p.y-=.025*e.deltaY;break;case 1:p.y-=.01*e.deltaY;break;default:p.y-=25e-5*e.deltaY}s.dispatchEvent(R),s.dispatchEvent(y)}}function B(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:r=a.TOUCH_ROTATE,h.copy(V(e.touches[0].pageX,e.touches[0].pageY)),l.copy(h);break;default:r=a.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;f=E=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(j(i,o)),v.copy(g)}s.dispatchEvent(R)}}function U(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(h),h.copy(V(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;f=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(j(i,o))}}function X(e){if(!1!==s.enabled){switch(e.touches.length){case 0:r=a.NONE;break;case 1:r=a.TOUCH_ROTATE,h.copy(V(e.touches[0].pageX,e.touches[0].pageY)),l.copy(h)}s.dispatchEvent(y)}}function q(e){!1!==s.enabled&&e.preventDefault()}this.rotateCamera=(O=new THREE.Vector3,k=new THREE.Quaternion,P=new THREE.Vector3,L=new THREE.Vector3,_=new THREE.Vector3,M=new THREE.Vector3,function(){M.set(h.x-l.x,h.y-l.y,0),(H=M.length())?(c.copy(s.object.position).sub(s.target),P.copy(c).normalize(),L.copy(s.object.up).normalize(),_.crossVectors(L,P).normalize(),L.setLength(h.y-l.y),_.setLength(h.x-l.x),M.copy(L.add(_)),O.crossVectors(M,c).normalize(),H*=s.rotateSpeed,k.setFromAxisAngle(O,H),c.applyQuaternion(k),s.object.up.applyQuaternion(k),u.copy(O),d=H):!s.staticMoving&&d&&(d*=Math.sqrt(1-s.dynamicDampingFactor),c.copy(s.object.position).sub(s.target),k.setFromAxisAngle(u,d),c.applyQuaternion(k),s.object.up.applyQuaternion(k)),l.copy(h)}),this.zoomCamera=function(){var e;r===a.TOUCH_ZOOM_PAN?(e=E/f,E=f,s.object.isPerspectiveCamera?c.multiplyScalar(e):s.object.isOrthographicCamera?(s.object.zoom*=e,s.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(m.y-p.y)*s.zoomSpeed)&&0<e&&(s.object.isPerspectiveCamera?c.multiplyScalar(e):s.object.isOrthographicCamera?(s.object.zoom/=e,s.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),s.staticMoving?p.copy(m):p.y+=(m.y-p.y)*this.dynamicDampingFactor)},this.panCamera=(S=new THREE.Vector2,x=new THREE.Vector3,C=new THREE.Vector3,function(){if(S.copy(v).sub(g),S.lengthSq()){if(s.object.isOrthographicCamera){var e=(s.object.right-s.object.left)/s.object.zoom/s.domElement.clientWidth,t=(s.object.top-s.object.bottom)/s.object.zoom/s.domElement.clientWidth;S.x*=e,S.y*=t}S.multiplyScalar(c.length()*s.panSpeed),C.copy(c).cross(s.object.up).setLength(S.x),C.add(x.copy(s.object.up).setLength(S.y)),s.object.position.add(C),s.target.add(C),s.staticMoving?g.copy(v):g.add(S.subVectors(v,g).multiplyScalar(s.dynamicDampingFactor))}}),this.checkDistances=function(){s.noZoom&&s.noPan||(c.lengthSq()>s.maxDistance*s.maxDistance&&(s.object.position.addVectors(s.target,c.setLength(s.maxDistance)),p.copy(m)),c.lengthSq()<s.minDistance*s.minDistance&&(s.object.position.addVectors(s.target,c.setLength(s.minDistance)),p.copy(m)))},this.update=function(){c.subVectors(s.object.position,s.target),s.noRotate||s.rotateCamera(),s.noZoom||s.zoomCamera(),s.noPan||s.panCamera(),s.object.position.addVectors(s.target,c),s.object.isPerspectiveCamera?(s.checkDistances(),s.object.lookAt(s.target),1e-6<n.distanceToSquared(s.object.position)&&(s.dispatchEvent(b),n.copy(s.object.position))):s.object.isOrthographicCamera?(s.object.lookAt(s.target),(1e-6<n.distanceToSquared(s.object.position)||i!==s.object.zoom)&&(s.dispatchEvent(b),n.copy(s.object.position),i=s.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){r=a.NONE,o=a.NONE,s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.up.copy(s.up0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),c.subVectors(s.object.position,s.target),s.object.lookAt(s.target),s.dispatchEvent(b),n.copy(s.object.position),i=s.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",q,!1),this.domElement.removeEventListener("mousedown",N,!1),this.domElement.removeEventListener("wheel",Y,!1),this.domElement.removeEventListener("touchstart",B,!1),this.domElement.removeEventListener("touchend",X,!1),this.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",F,!1),window.removeEventListener("keydown",A,!1),window.removeEventListener("keyup",D,!1)},this.domElement.addEventListener("contextmenu",q,!1),this.domElement.addEventListener("mousedown",N,!1),this.domElement.addEventListener("wheel",Y,!1),this.domElement.addEventListener("touchstart",B,!1),this.domElement.addEventListener("touchend",X,!1),this.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",A,!1),window.addEventListener("keyup",D,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.VRControls=function(n,i){var o,s=this,a=new THREE.Matrix4;function e(e){for(var t=0;t<e.length;t++)if("VRDisplay"in window&&e[t]instanceof VRDisplay||"PositionSensorVRDevice"in window&&e[t]instanceof PositionSensorVRDevice){o=e[t];break}o||i&&i("VR input not available.")}navigator.getVRDisplays?navigator.getVRDisplays().then(e):navigator.getVRDevices&&navigator.getVRDevices().then(e),this.scale=1,this.standing=!1,this.userHeight=1.6,this.update=function(){if(o){if(o.getPose){var e=o.getPose();null!==e.orientation&&n.quaternion.fromArray(e.orientation),null!==e.position?n.position.fromArray(e.position):n.position.set(0,0,0)}else{var t=o.getState();null!==t.orientation&&n.quaternion.copy(t.orientation),null!==t.position?n.position.copy(t.position):n.position.set(0,0,0)}this.standing&&(o.stageParameters?(n.updateMatrix(),a.fromArray(o.stageParameters.sittingToStandingTransform),n.applyMatrix(a)):n.position.setY(n.position.y+this.userHeight)),n.position.multiplyScalar(s.scale)}},this.resetPose=function(){o&&(void 0!==o.resetPose?o.resetPose():void 0!==o.resetSensor?o.resetSensor():void 0!==o.zeroSensor&&o.zeroSensor())},this.resetSensor=function(){console.warn("THREE.VRControls: .resetSensor() is now .resetPose()."),this.resetPose()},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetPose()."),this.resetPose()},this.dispose=function(){o=null}},THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new Stats,n=t.domElement.style;n.position="absolute",n.top=n.left=0,e.element.appendChild(t.domElement),e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement),delete e.stats},pre:function(e,t){this.stats.begin()},post:function(e,t){this.stats.end()}}),THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null,this._camera=e.camera||new THREE.PerspectiveCamera,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.options.klass?(e&&!e.changes.klass||(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),_.extend(t.controls,this.options.parameters)):t.controls=null},update:function(e,t){var n=t.Time&&t.Time.delta||1/60,i=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(i),t.controls.update(n)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}}),THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(e){this.timeout=this.options.timeout,this.element=e.element,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(e,t){var n=t.Time&&t.Time.delta||1/60;this.options.hide&&(this.timeout-=n,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(e,t){this.hide=e.active&&!e.hmd.fake,this.applyCursor(t)},applyCursor:function(e,t){var n=e.controls?"move":"";t=t||this.options.cursor||n,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}}),THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){this.options.key&&e.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}.bind(this));var n=function(){var e=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);t.Fullscreen.active=this.active=e,t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1)},toggle:function(e){var t=e.canvas,n=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(n):t.msRequestFullScreen?t.msRequestFullscreen(n):t.webkitRequestFullscreen?t.webkitRequestFullscreen(n):t.mozRequestFullScreen&&t.mozRequestFullScreen(n)}}),THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(e){e.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(s,a,r){return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:function(e){return{left:{x:-.03,y:0,z:0},right:{x:.03,y:0,z:0}}[e]},getRecommendedEyeFieldOfView:function(e){var t=s.camera,n=t&&t.aspect||16/9,i=(a||t&&t.fov||r)/2,o=180*Math.atan(Math.tan(i*Math.PI/180)*n/2)/Math.PI;return{left:{rightDegrees:o,leftDegrees:o,downDegrees:i,upDegrees:i},right:{rightDegrees:o,leftDegrees:o,downDegrees:i,upDegrees:i}}[e]}},{force:2,getState:function(){return{}}}]},load:function(e,t){var n=function(e){this.callback(e,t)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(n):navigator.mozGetVRDevices?navigator.mozGetVRDevices(n):(console.warn("No native VR support detected."),n(this.mocks(t,this.options.fov,this.defaults.fov),t))},callback:function(e,t){var n,i,o=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;for(var a=this.options.device,r=0;r<e.length;++r){if(1==(c=e[r]).force||c instanceof o){if(a&&a!=c.deviceId)continue;n=c;break}}if(n){for(r=0;r<e.length;++r){var c;if(2==(c=e[r]).force||c instanceof s&&c.hardwareUnitId==n.hardwareUnitId){i=c;break}}this.hookup(n,i,t)}},hookup:function(e,t,n){THREE.VRRenderer||console.log("THREE.VRRenderer not found");var i=THREE.VRRenderer||function(){};this.renderer=new i(n.renderer,e),this.hmd=e,this.sensor=t,n.VR.renderer=this.renderer,n.VR.hmd=e,n.VR.sensor=t,console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){e.changes.device&&this.callback(null,t),this.pre(e,t)},pre:function(e,t){var n=this.active,i=this.active=this.renderer&&"2d"!=this.options.mode;if((t.VR.active=i)&&this.sensor){var o=this.sensor.getState();t.VR.state=o}else t.VR.state=null;n!=this.active&&t.trigger({type:"vr",active:i,hmd:this.hmd,sensor:this.sensor})},resize:function(e,t){this.active&&this.renderer.initialize()},render:function(e,t){if(t.scene&&t.camera){var n=this.active?this.renderer:t.renderer;if(this.last!=n&&n==t.renderer){var i=n.getPixelRatio(),o=n.domElement.width/i,s=n.domElement.height/i;n.setScissorTest(!1),n.setViewport(0,0,o,s)}(this.last=n).render(t.scene,t.camera)}}}),THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,n){var i="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(i="http://"+i);var o=[];return e.Fullscreen&&o.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),e.VR&&o.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+i+'"); '+n+'</style><div class="threestrap-ui threestrap-'+t+'">'+o.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style),document.body.appendChild(t);var n=this.ui.fullscreen=t.querySelector("button.fullscreen");n&&e.bind([n,"click:goFullscreen"],this);var i=this.ui.vr=t.querySelector("button.vr");i&&e.VR&&(e.VR.set({mode:"2d"}),e.bind([i,"click:goVR"],this))},uninstall:function(e){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block",e.active||t.VR&&t.VR.set({mode:"2d"})},goFullscreen:function(e,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(e,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(e){document.body.removeChild(this.ui)}});
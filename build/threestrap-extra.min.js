THREE.Stats=function(){var e=Date.now(),t=e,n=0,o=1/0,i=0,s=0,a=1/0,r=0,c=0,l=0,h=document.createElement("div");h.id="stats",h.addEventListener("mousedown",function(e){e.preventDefault(),g(++l%2)},!1),h.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",h.appendChild(d);var u=document.createElement("div");u.id="fpsText",u.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",u.innerHTML="FPS",d.appendChild(u);var m=document.createElement("div");for(m.id="fpsGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(m);74>m.children.length;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#113",m.appendChild(p)}var E=document.createElement("div");E.id="ms",E.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",h.appendChild(E);var v=document.createElement("div");v.id="msText",v.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",v.innerHTML="MS",E.appendChild(v);var f=document.createElement("div");for(f.id="msGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",E.appendChild(f);74>f.children.length;)p=document.createElement("span"),p.style.cssText="width:1px;height:30px;float:left;background-color:#131",f.appendChild(p);var g=function(e){switch(l=e){case 0:d.style.display="block",E.style.display="none";break;case 1:d.style.display="none",E.style.display="block"}};return{REVISION:11,domElement:h,setMode:g,begin:function(){e=Date.now()},end:function(){var l=Date.now();n=l-e,o=Math.min(o,n),i=Math.max(i,n),v.textContent=n+" MS ("+o+"-"+i+")";var h=Math.min(30,30-30*(n/200));return f.appendChild(f.firstChild).style.height=h+"px",c++,l>t+1e3&&(s=Math.round(1e3*c/(l-t)),a=Math.min(a,s),r=Math.max(r,s),u.textContent=s+" FPS ("+a+"-"+r+")",h=Math.min(30,30-30*(s/100)),m.appendChild(m.firstChild).style.height=h+"px",t=l,c=0),l},update:function(){e=this.end()}}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alpha=0,this.alphaOffsetAngle=0;var n=function(e){t.deviceOrientation=e},o=function(){t.screenOrientation=window.orientation||0},i=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,s,a,r,c){t.set(a,s,-r,"YXZ"),i.setFromEuler(t),i.multiply(o),i.multiply(n.setFromAxisAngle(e,-c))}}();this.connect=function(){o(),window.addEventListener("orientationchange",o,!1),window.addEventListener("deviceorientation",n,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientation",n,!1),t.enabled=!1},this.update=function(){if(t.enabled!==!1){var e=t.deviceOrientation.alpha?THREE.Math.degToRad(t.deviceOrientation.alpha)+this.alphaOffsetAngle:0,n=t.deviceOrientation.beta?THREE.Math.degToRad(t.deviceOrientation.beta):0,o=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.gamma):0,s=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;i(t.object.quaternion,e,n,o,s),this.alpha=e}},this.updateAlphaOffsetAngle=function(e){this.alphaOffsetAngle=e,this.update()},this.dispose=function(){this.disconnect()},this.connect()},THREE.FirstPersonControls=function(e,t){function n(e){e.preventDefault()}function o(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(this.enabled!==!1){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),n=t-this.heightMin;this.autoSpeedFactor=e*n*this.heightCoef}else this.autoSpeedFactor=0;var o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);var i=e*this.lookSpeed;this.activeLook||(i=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*s),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var a=this.target,r=this.object.position;a.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),a.y=r.y+100*Math.cos(this.phi),a.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(a)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",n,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("mousemove",i,!1),this.domElement.removeEventListener("mouseup",a,!1),window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",c,!1)};var i=o(this,this.onMouseMove),s=o(this,this.onMouseDown),a=o(this,this.onMouseUp),r=o(this,this.onKeyDown),c=o(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",n,!1),this.domElement.addEventListener("mousemove",i,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mouseup",a,!1),window.addEventListener("keydown",r,!1),window.addEventListener("keyup",c,!1),this.handleResize()},THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*D.autoRotateSpeed}function o(){return Math.pow(.95,D.zoomSpeed)}function i(e){X.theta-=e}function s(e){X.phi-=e}function a(e){D.object instanceof THREE.PerspectiveCamera?U/=e:D.object instanceof THREE.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom*e)),D.object.updateProjectionMatrix(),q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function r(e){D.object instanceof THREE.PerspectiveCamera?U*=e:D.object instanceof THREE.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom/e)),D.object.updateProjectionMatrix(),q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function c(e){I.set(e.clientX,e.clientY)}function l(e){W.set(e.clientX,e.clientY)}function h(e){K.set(e.clientX,e.clientY)}function d(e){B.set(e.clientX,e.clientY),_.subVectors(B,I);var t=D.domElement===document?D.domElement.body:D.domElement;i(2*Math.PI*_.x/t.clientWidth*D.rotateSpeed),s(2*Math.PI*_.y/t.clientHeight*D.rotateSpeed),I.copy(B),D.update()}function u(e){J.set(e.clientX,e.clientY),$.subVectors(J,W),$.y>0?a(o()):$.y<0&&r(o()),W.copy(J),D.update()}function m(e){Q.set(e.clientX,e.clientY),G.subVectors(Q,K),nt(G.x,G.y),K.copy(Q),D.update()}function p(){}function E(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?r(o()):0>t&&a(o()),D.update()}function v(e){switch(e.keyCode){case D.keys.UP:nt(0,D.keyPanSpeed),D.update();break;case D.keys.BOTTOM:nt(0,-D.keyPanSpeed),D.update();break;case D.keys.LEFT:nt(D.keyPanSpeed,0),D.update();break;case D.keys.RIGHT:nt(-D.keyPanSpeed,0),D.update()}}function f(e){I.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);W.set(0,o)}function b(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function w(e){B.set(e.touches[0].pageX,e.touches[0].pageY),_.subVectors(B,I);var t=D.domElement===document?D.domElement.body:D.domElement;i(2*Math.PI*_.x/t.clientWidth*D.rotateSpeed),s(2*Math.PI*_.y/t.clientHeight*D.rotateSpeed),I.copy(B),D.update()}function y(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);J.set(0,i),$.subVectors(J,W),$.y>0?r(o()):$.y<0&&a(o()),W.copy(J),D.update()}function R(e){Q.set(e.touches[0].pageX,e.touches[0].pageY),G.subVectors(Q,K),nt(G.x,G.y),K.copy(Q),D.update()}function T(){}function H(e){if(D.enabled!==!1){if(e.preventDefault(),e.button===D.mouseButtons.ORBIT){if(D.enableRotate===!1)return;c(e),N=F.ROTATE}else if(e.button===D.mouseButtons.ZOOM){if(D.enableZoom===!1)return;l(e),N=F.DOLLY}else if(e.button===D.mouseButtons.PAN){if(D.enablePan===!1)return;h(e),N=F.PAN}N!==F.NONE&&(document.addEventListener("mousemove",O,!1),document.addEventListener("mouseup",k,!1),D.dispatchEvent(j))}}function O(e){if(D.enabled!==!1)if(e.preventDefault(),N===F.ROTATE){if(D.enableRotate===!1)return;d(e)}else if(N===F.DOLLY){if(D.enableZoom===!1)return;u(e)}else if(N===F.PAN){if(D.enablePan===!1)return;m(e)}}function k(e){D.enabled!==!1&&(p(e),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",k,!1),D.dispatchEvent(A),N=F.NONE)}function x(e){D.enabled===!1||D.enableZoom===!1||N!==F.NONE&&N!==F.ROTATE||(e.preventDefault(),e.stopPropagation(),E(e),D.dispatchEvent(j),D.dispatchEvent(A))}function M(e){D.enabled!==!1&&D.enableKeys!==!1&&D.enablePan!==!1&&v(e)}function V(e){if(D.enabled!==!1){switch(e.touches.length){case 1:if(D.enableRotate===!1)return;f(e),N=F.TOUCH_ROTATE;break;case 2:if(D.enableZoom===!1)return;g(e),N=F.TOUCH_DOLLY;break;case 3:if(D.enablePan===!1)return;b(e),N=F.TOUCH_PAN;break;default:N=F.NONE}N!==F.NONE&&D.dispatchEvent(j)}}function L(e){if(D.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(D.enableRotate===!1)return;if(N!==F.TOUCH_ROTATE)return;w(e);break;case 2:if(D.enableZoom===!1)return;if(N!==F.TOUCH_DOLLY)return;y(e);break;case 3:if(D.enablePan===!1)return;if(N!==F.TOUCH_PAN)return;R(e);break;default:N=F.NONE}}function P(e){D.enabled!==!1&&(T(e),D.dispatchEvent(A),N=F.NONE)}function C(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return phi},this.getAzimuthalAngle=function(){return theta},this.reset=function(){D.target.copy(D.target0),D.object.position.copy(D.position0),D.object.zoom=D.zoom0,D.object.updateProjectionMatrix(),D.dispatchEvent(S),D.update(),N=F.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),s=o.clone().inverse(),a=new THREE.Vector3,r=new THREE.Quaternion;return function(){var e=D.object.position;return t.copy(e).sub(D.target),t.applyQuaternion(o),Y.setFromVector3(t),D.autoRotate&&N===F.NONE&&i(n()),Y.theta+=X.theta,Y.phi+=X.phi,Y.theta=Math.max(D.minAzimuthAngle,Math.min(D.maxAzimuthAngle,Y.theta)),Y.phi=Math.max(D.minPolarAngle,Math.min(D.maxPolarAngle,Y.phi)),Y.makeSafe(),Y.radius*=U,Y.radius=Math.max(D.minDistance,Math.min(D.maxDistance,Y.radius)),D.target.add(Z),t.setFromSpherical(Y),t.applyQuaternion(s),e.copy(D.target).add(t),D.object.lookAt(D.target),D.enableDamping===!0?(X.theta*=1-D.dampingFactor,X.phi*=1-D.dampingFactor):X.set(0,0,0),U=1,Z.set(0,0,0),q||a.distanceToSquared(D.object.position)>z||8*(1-r.dot(D.object.quaternion))>z?(D.dispatchEvent(S),a.copy(D.object.position),r.copy(D.object.quaternion),q=!1,!0):!1}}(),this.dispose=function(){D.domElement.removeEventListener("contextmenu",C,!1),D.domElement.removeEventListener("mousedown",H,!1),D.domElement.removeEventListener("mousewheel",x,!1),D.domElement.removeEventListener("MozMousePixelScroll",x,!1),D.domElement.removeEventListener("touchstart",V,!1),D.domElement.removeEventListener("touchend",P,!1),D.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",k,!1),window.removeEventListener("keydown",M,!1)};var D=this,S={type:"change"},j={type:"start"},A={type:"end"},F={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},N=F.NONE,z=1e-6,Y=new THREE.Spherical,X=new THREE.Spherical,U=1,Z=new THREE.Vector3,q=!1,I=new THREE.Vector2,B=new THREE.Vector2,_=new THREE.Vector2,K=new THREE.Vector2,Q=new THREE.Vector2,G=new THREE.Vector2,W=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,et=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),Z.add(e)}}(),tt=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),Z.add(e)}}(),nt=function(){var e=new THREE.Vector3;return function(t,n){var o=D.domElement===document?D.domElement.body:D.domElement;if(D.object instanceof THREE.PerspectiveCamera){var i=D.object.position;e.copy(i).sub(D.target);var s=e.length();s*=Math.tan(D.object.fov/2*Math.PI/180),et(2*t*s/o.clientHeight,D.object.matrix),tt(2*n*s/o.clientHeight,D.object.matrix)}else D.object instanceof THREE.OrthographicCamera?(et(t*(D.object.right-D.object.left)/D.object.zoom/o.clientWidth,D.object.matrix),tt(n*(D.object.top-D.object.bottom)/D.object.zoom/o.clientHeight,D.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),D.enablePan=!1)}}();D.domElement.addEventListener("contextmenu",C,!1),D.domElement.addEventListener("mousedown",H,!1),D.domElement.addEventListener("mousewheel",x,!1),D.domElement.addEventListener("MozMousePixelScroll",x,!1),D.domElement.addEventListener("touchstart",V,!1),D.domElement.addEventListener("touchend",P,!1),D.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",M,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}}),THREE.TrackballControls=function(e,t){function n(e){u.enabled!==!1&&(window.removeEventListener("keydown",n),f=v,v===m.NONE&&(e.keyCode!==u.keys[m.ROTATE]||u.noRotate?e.keyCode!==u.keys[m.ZOOM]||u.noZoom?e.keyCode!==u.keys[m.PAN]||u.noPan||(v=m.PAN):v=m.ZOOM:v=m.ROTATE))}function o(){u.enabled!==!1&&(v=f,window.addEventListener("keydown",n,!1))}function i(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v===m.NONE&&(v=e.button),v!==m.ROTATE||u.noRotate?v!==m.ZOOM||u.noZoom?v!==m.PAN||u.noPan||(x.copy(C(e.pageX,e.pageY)),M.copy(x)):(T.copy(C(e.pageX,e.pageY)),H.copy(T)):(w.copy(D(e.pageX,e.pageY)),b.copy(w)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(L))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v!==m.ROTATE||u.noRotate?v!==m.ZOOM||u.noZoom?v!==m.PAN||u.noPan||M.copy(C(e.pageX,e.pageY)):H.copy(C(e.pageX,e.pageY)):(b.copy(w),w.copy(D(e.pageX,e.pageY))))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v=m.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),u.dispatchEvent(P))}function r(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),T.y+=.01*t,u.dispatchEvent(L),u.dispatchEvent(P)}}function c(e){if(u.enabled!==!1){switch(e.touches.length){case 1:v=m.TOUCH_ROTATE,w.copy(D(e.touches[0].pageX,e.touches[0].pageY)),b.copy(w);break;default:v=m.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;k=O=Math.sqrt(t*t+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;x.copy(C(o,i)),M.copy(x)}u.dispatchEvent(L)}}function l(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:b.copy(w),w.copy(D(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;k=Math.sqrt(t*t+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(C(o,i))}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 0:v=m.NONE;break;case 1:v=m.TOUCH_ROTATE,w.copy(D(e.touches[0].pageX,e.touches[0].pageY)),b.copy(w)}u.dispatchEvent(P)}}function d(e){e.preventDefault()}var u=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=1e-6,E=new THREE.Vector3,v=m.NONE,f=m.NONE,g=new THREE.Vector3,b=new THREE.Vector2,w=new THREE.Vector2,y=new THREE.Vector3,R=0,T=new THREE.Vector2,H=new THREE.Vector2,O=0,k=0,x=new THREE.Vector2,M=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var V={type:"change"},L={type:"start"},P={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var C=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-u.screen.left)/u.screen.width,(n-u.screen.top)/u.screen.height),e}}(),D=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(u.screen.height+2*(u.screen.top-n))/u.screen.width),e}}();this.rotateCamera=function(){var e,t=new THREE.Vector3,n=new THREE.Quaternion,o=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3;return function(){a.set(w.x-b.x,w.y-b.y,0),e=a.length(),e?(g.copy(u.object.position).sub(u.target),o.copy(g).normalize(),i.copy(u.object.up).normalize(),s.crossVectors(i,o).normalize(),i.setLength(w.y-b.y),s.setLength(w.x-b.x),a.copy(i.add(s)),t.crossVectors(a,g).normalize(),e*=u.rotateSpeed,n.setFromAxisAngle(t,e),g.applyQuaternion(n),u.object.up.applyQuaternion(n),y.copy(t),R=e):!u.staticMoving&&R&&(R*=Math.sqrt(1-u.dynamicDampingFactor),g.copy(u.object.position).sub(u.target),n.setFromAxisAngle(y,R),g.applyQuaternion(n),u.object.up.applyQuaternion(n)),b.copy(w)}}(),this.zoomCamera=function(){var e;v===m.TOUCH_ZOOM_PAN?(e=O/k,O=k,g.multiplyScalar(e)):(e=1+(H.y-T.y)*u.zoomSpeed,1!==e&&e>0&&(g.multiplyScalar(e),u.staticMoving?T.copy(H):T.y+=(H.y-T.y)*this.dynamicDampingFactor))},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.copy(M).sub(x),e.lengthSq()&&(e.multiplyScalar(g.length()*u.panSpeed),n.copy(g).cross(u.object.up).setLength(e.x),n.add(t.copy(u.object.up).setLength(e.y)),u.object.position.add(n),u.target.add(n),u.staticMoving?x.copy(M):x.add(e.subVectors(M,x).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(g.lengthSq()>u.maxDistance*u.maxDistance&&(u.object.position.addVectors(u.target,g.setLength(u.maxDistance)),T.copy(H)),g.lengthSq()<u.minDistance*u.minDistance&&(u.object.position.addVectors(u.target,g.setLength(u.minDistance)),T.copy(H)))},this.update=function(){g.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,g),u.checkDistances(),u.object.lookAt(u.target),E.distanceToSquared(u.object.position)>p&&(u.dispatchEvent(V),E.copy(u.object.position))},this.reset=function(){v=m.NONE,f=m.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),g.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(V),E.copy(u.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",i,!1),this.domElement.removeEventListener("mousewheel",r,!1),this.domElement.removeEventListener("MozMousePixelScroll",r,!1),this.domElement.removeEventListener("touchstart",c,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",l,!1),document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",a,!1),window.removeEventListener("keydown",n,!1),window.removeEventListener("keyup",o,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",r,!1),this.domElement.addEventListener("MozMousePixelScroll",r,!1),this.domElement.addEventListener("touchstart",c,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.VRControls=function(e,t){function n(e){for(var n=0;n<e.length;n++)if("VRDisplay"in window&&e[n]instanceof VRDisplay||"PositionSensorVRDevice"in window&&e[n]instanceof PositionSensorVRDevice){o=e[n];break}o||t&&t("VR input not available.")}var o,i=this,s=new THREE.Matrix4;navigator.getVRDisplays?navigator.getVRDisplays().then(n):navigator.getVRDevices&&navigator.getVRDevices().then(n),this.scale=1,this.standing=!1,this.userHeight=1.6,this.update=function(){if(o){if(o.getPose){var t=o.getPose();null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0)}else{var n=o.getState();null!==n.orientation&&e.quaternion.copy(n.orientation),null!==n.position?e.position.copy(n.position):e.position.set(0,0,0)}this.standing&&(o.stageParameters?(e.updateMatrix(),s.fromArray(o.stageParameters.sittingToStandingTransform),e.applyMatrix(s)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(i.scale)}},this.resetPose=function(){o&&(void 0!==o.resetPose?o.resetPose():void 0!==o.resetSensor?o.resetSensor():void 0!==o.zeroSensor&&o.zeroSensor())},this.resetSensor=function(){console.warn("THREE.VRControls: .resetSensor() is now .resetPose()."),this.resetPose()},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetPose()."),this.resetPose()},this.dispose=function(){o=null}},THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new THREE.Stats,n=t.domElement.style;n.position="absolute",n.top=n.left=0,e.element.appendChild(t.domElement),e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement),delete e.stats},pre:function(){this.stats.begin()},post:function(){this.stats.end()}}),THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null,this._camera=e.camera||new THREE.PerspectiveCamera,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.options.klass?((!e||e.changes.klass)&&(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),_.extend(t.controls,this.options.parameters)):t.controls=null},update:function(e,t){var n=t.Time&&t.Time.delta||1/60,o=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(o),t.controls.update(n)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}}),THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(e){this.timeout=this.options.timeout,this.element=e.element,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(e,t){var n=t.Time&&t.Time.delta||1/60;this.options.hide&&(this.timeout-=n,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(e,t){this.hide=e.active&&!e.hmd.fake,this.applyCursor(t)},applyCursor:function(e,t){var n=e.controls?"move":"";t=t||this.options.cursor||n,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}}),THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){this.options.key&&e.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}.bind(this));var n=function(){var e=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);t.Fullscreen.active=this.active=e,t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1)},toggle:function(e){var t=e.canvas,n=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(n):t.msRequestFullScreen?t.msRequestFullscreen(n):t.webkitRequestFullscreen?t.webkitRequestFullscreen(n):t.mozRequestFullScreen&&t.mozRequestFullScreen(n)}}),THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(e){e.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(e,t,n){var o=.03,i=function(e){return{left:{x:-o,y:0,z:0},right:{x:o,y:0,z:0}}[e]},s=function(o){var i=e.camera,s=i&&i.aspect||16/9,a=(t||i&&i.fov||n)/2,r=180*Math.atan(Math.tan(a*Math.PI/180)*s/2)/Math.PI,c=a;return{left:{rightDegrees:r,leftDegrees:r,downDegrees:c,upDegrees:c},right:{rightDegrees:r,leftDegrees:r,downDegrees:c,upDegrees:c}}[o]},a=function(){return{}};return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:i,getRecommendedEyeFieldOfView:s},{force:2,getState:a}]},load:function(e,t){var n=function(e){this.callback(e,t)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(n):navigator.mozGetVRDevices?navigator.mozGetVRDevices(n):(console.warn("No native VR support detected."),n(this.mocks(t,this.options.fov,this.defaults.fov),t))},callback:function(e,t){var n,o,i=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;for(var a=this.options.device,r=0;r<e.length;++r){var c=e[r];if(1==c.force||c instanceof i){if(a&&a!=c.deviceId)continue;n=c;break}}if(n){for(var r=0;r<e.length;++r){var c=e[r];if(2==c.force||c instanceof s&&c.hardwareUnitId==n.hardwareUnitId){o=c;
break}}this.hookup(n,o,t)}},hookup:function(e,t,n){THREE.VRRenderer||console.log("THREE.VRRenderer not found");var o=THREE.VRRenderer||function(){};this.renderer=new o(n.renderer,e),this.hmd=e,this.sensor=t,n.VR.renderer=this.renderer,n.VR.hmd=e,n.VR.sensor=t,console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){e.changes.device&&this.callback(null,t),this.pre(e,t)},pre:function(e,t){var n=this.active,o=this.active=this.renderer&&"2d"!=this.options.mode;if(t.VR.active=o,o&&this.sensor){var i=this.sensor.getState();t.VR.state=i}else t.VR.state=null;n!=this.active&&t.trigger({type:"vr",active:o,hmd:this.hmd,sensor:this.sensor})},resize:function(){this.active&&this.renderer.initialize()},render:function(e,t){if(t.scene&&t.camera){var n=this.active?this.renderer:t.renderer;if(this.last!=n&&n==t.renderer){var o=n.getPixelRatio(),i=n.domElement.width/o,s=n.domElement.height/o;n.enableScissorTest(!1),n.setViewport(0,0,i,s)}this.last=n,n.render(t.scene,t.camera)}}}),THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,n){var o="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(o="http://"+o);var i=[];return e.Fullscreen&&i.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),e.VR&&i.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+o+'"); '+n+'</style><div class="threestrap-ui threestrap-'+t+'">'+i.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style),document.body.appendChild(t);var n=this.ui.fullscreen=t.querySelector("button.fullscreen");n&&e.bind([n,"click:goFullscreen"],this);var o=this.ui.vr=t.querySelector("button.vr");o&&(e.VR.set({mode:"2d"}),e.bind([o,"click:goVR"],this))},uninstall:function(){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block",e.active||t.VR.set({mode:"2d"})},goFullscreen:function(e,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(e,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(){document.body.removeChild(this.ui)}});
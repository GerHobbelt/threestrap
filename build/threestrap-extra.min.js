var Stats=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";o=e}var o=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++o%n.children.length)},!1);var i=(performance||Date).now(),s=i,a=0,r=e(new Stats.Panel("FPS","#0ff","#002")),c=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new Stats.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-i,200),s+1e3<e&&(r.update(1e3*a/(e-s),100),s=e,a=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:n,setMode:t}};Stats.Panel=function(o,n,i){var s=1/0,a=0,r=Math.round,c=r(window.devicePixelRatio||1),l=80*c,e=48*c,h=3*c,u=2*c,d=3*c,m=15*c,p=74*c,E=30*c,v=document.createElement("canvas");v.width=l,v.height=e,v.style.cssText="width:80px;height:48px";var f=v.getContext("2d");return f.font="bold "+9*c+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,l,e),f.fillStyle=n,f.fillText(o,h,u),f.fillRect(d,m,p,E),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d,m,p,E),{dom:v,update:function(e,t){s=Math.min(s,e),a=Math.max(a,e),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,l,m),f.fillStyle=n,f.fillText(r(e)+" "+o+" ("+r(s)+"-"+r(a)+")",h,u),f.drawImage(v,d+c,m,p-c,E,d,m,p-c,E),f.fillRect(d+p-c,m,c,E),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d+p-c,m,c,r((1-e/t)*E))}}},"object"==typeof module&&(module.exports=Stats),THREE.DeviceOrientationControls=function(e){var s=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;function t(e){s.deviceOrientation=e}function o(){s.screenOrientation=window.orientation||0}var a,r,c,l,h=(a=new THREE.Vector3(0,0,1),r=new THREE.Euler,c=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,o,n,i){r.set(o,t,-n,"YXZ"),e.setFromEuler(r),e.multiply(l),e.multiply(c.setFromAxisAngle(a,-i))});this.connect=function(){o(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(function(e){"granted"==e&&(window.addEventListener("orientationchange",o,!1),window.addEventListener("deviceorientation",t,!1))}).catch(function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",o,!1),window.addEventListener("deviceorientation",t,!1)),s.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientation",t,!1),s.enabled=!1},this.update=function(){if(!1!==s.enabled){var e=s.deviceOrientation;if(e){var t=e.alpha?THREE.MathUtils.degToRad(e.alpha)+s.alphaOffset:0,o=e.beta?THREE.MathUtils.degToRad(e.beta):0,n=e.gamma?THREE.MathUtils.degToRad(e.gamma):0,i=s.screenOrientation?THREE.MathUtils.degToRad(s.screenOrientation):0;h(s.object.quaternion,t,o,n,i)}}},this.dispose=function(){s.disconnect()},this.connect()},THREE.FirstPersonControls=function(e,t){void 0===t&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0;var c,l=this.viewHalfY=0,h=0,o=new THREE.Vector3,n=new THREE.Spherical,i=new THREE.Vector3;function s(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,o){return e.isVector3?i.copy(e):i.set(e,t,o),this.object.lookAt(i),E(this),this},this.update=(c=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);var n=e*this.lookSpeed;this.activeLook||(n=0);var i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),h-=this.mouseX*n,this.lookVertical&&(l-=this.mouseY*n*i),l=Math.max(-85,Math.min(85,l));var s=THREE.MathUtils.degToRad(90-l),a=THREE.MathUtils.degToRad(h);this.constrainVertical&&(s=THREE.MathUtils.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));var r=this.object.position;c.setFromSphericalCoords(1,s,a).add(r),this.object.lookAt(c)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",s,!1),this.domElement.removeEventListener("mousedown",r,!1),this.domElement.removeEventListener("mousemove",a,!1),this.domElement.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",m,!1)};var a=p(this,this.onMouseMove),r=p(this,this.onMouseDown),u=p(this,this.onMouseUp),d=p(this,this.onKeyDown),m=p(this,this.onKeyUp);function p(e,t){return function(){t.apply(e,arguments)}}function E(e){var t=e.object.quaternion;o.set(0,0,-1).applyQuaternion(t),n.setFromVector3(o),l=90-THREE.MathUtils.radToDeg(n.phi),h=THREE.MathUtils.radToDeg(n.theta)}this.domElement.addEventListener("contextmenu",s,!1),this.domElement.addEventListener("mousemove",a,!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mouseup",u,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",m,!1),this.handleResize(),E(this)},THREE.OrbitControls=function(e,t){var o,n,i,s,a;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(c),r.update(),d=u.NONE},this.update=(o=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),s=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=r.object.position;return o.copy(e).sub(r.target),o.applyQuaternion(n),p.setFromVector3(o),r.autoRotate&&d===u.NONE&&M(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(p.theta+=E.theta*r.dampingFactor,p.phi+=E.phi*r.dampingFactor):(p.theta+=E.theta,p.phi+=E.phi),p.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,p.theta)),p.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=v,p.radius=Math.max(r.minDistance,Math.min(r.maxDistance,p.radius)),!0===r.enableDamping?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),o.setFromSpherical(p),o.applyQuaternion(i),e.copy(r.target).add(o),r.object.lookAt(r.target),!0===r.enableDamping?(E.theta*=1-r.dampingFactor,E.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(E.set(0,0,0),f.set(0,0,0)),v=1,!(!(g||s.distanceToSquared(r.object.position)>m||8*(1-a.dot(r.object.quaternion))>m)||(r.dispatchEvent(c),s.copy(r.object.position),a.copy(r.object.quaternion),g=!1))}),this.dispose=function(){r.domElement.removeEventListener("contextmenu",te,!1),r.domElement.removeEventListener("mousedown",B,!1),r.domElement.removeEventListener("wheel",Q,!1),r.domElement.removeEventListener("touchstart",J,!1),r.domElement.removeEventListener("touchend",ee,!1),r.domElement.removeEventListener("touchmove",$,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",K,!1),r.domElement.removeEventListener("keydown",W,!1)};var r=this,c={type:"change"},l={type:"start"},h={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=u.NONE,m=1e-6,p=new THREE.Spherical,E=new THREE.Spherical,v=1,f=new THREE.Vector3,g=!1,b=new THREE.Vector2,R=new THREE.Vector2,T=new THREE.Vector2,w=new THREE.Vector2,y=new THREE.Vector2,H=new THREE.Vector2,O=new THREE.Vector2,k=new THREE.Vector2,P=new THREE.Vector2;function L(){return Math.pow(.95,r.zoomSpeed)}function M(e){E.theta-=e}function j(e){E.phi-=e}var S,V,D,C=(S=new THREE.Vector3,function(e,t){S.setFromMatrixColumn(t,0),S.multiplyScalar(-e),f.add(S)}),x=(V=new THREE.Vector3,function(e,t){!0===r.screenSpacePanning?V.setFromMatrixColumn(t,1):(V.setFromMatrixColumn(t,0),V.crossVectors(r.object.up,V)),V.multiplyScalar(e),f.add(V)}),A=(D=new THREE.Vector3,function(e,t){var o=r.domElement;if(r.object.isPerspectiveCamera){var n=r.object.position;D.copy(n).sub(r.target);var i=D.length();i*=Math.tan(r.object.fov/2*Math.PI/180),C(2*e*i/o.clientHeight,r.object.matrix),x(2*t*i/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(C(e*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),x(t*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)});function N(e){r.object.isPerspectiveCamera?v/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Y(e){r.object.isPerspectiveCamera?v*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function F(e){b.set(e.clientX,e.clientY)}function z(e){w.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,o)}}function X(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,o)}}function Z(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);O.set(0,n)}function I(e){if(1==e.touches.length)R.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);R.set(t,o)}T.subVectors(R,b).multiplyScalar(r.rotateSpeed);var n=r.domElement;M(2*Math.PI*T.x/n.clientHeight),j(2*Math.PI*T.y/n.clientHeight),b.copy(R)}function _(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,o)}H.subVectors(y,w).multiplyScalar(r.panSpeed),A(H.x,H.y),w.copy(y)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);k.set(0,n),P.set(0,Math.pow(k.y/O.y,r.zoomSpeed)),N(P.y),O.copy(k)}function B(e){if(!1!==r.enabled){var t;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){O.set(e.clientX,e.clientY)}(e),d=u.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;z(e),d=u.PAN}else{if(!1===r.enableRotate)return;F(e),d=u.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;F(e),d=u.ROTATE}else{if(!1===r.enablePan)return;z(e),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",K,!1),r.dispatchEvent(l))}}function G(e){if(!1!==r.enabled)switch(e.preventDefault(),d){case u.ROTATE:if(!1===r.enableRotate)return;!function(e){R.set(e.clientX,e.clientY),T.subVectors(R,b).multiplyScalar(r.rotateSpeed);var t=r.domElement;M(2*Math.PI*T.x/t.clientHeight),j(2*Math.PI*T.y/t.clientHeight),b.copy(R),r.update()}(e);break;case u.DOLLY:if(!1===r.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),P.subVectors(k,O),0<P.y?N(L()):P.y<0&&Y(L()),O.copy(k),r.update()}(e);break;case u.PAN:if(!1===r.enablePan)return;!function(e){y.set(e.clientX,e.clientY),H.subVectors(y,w).multiplyScalar(r.panSpeed),A(H.x,H.y),w.copy(y),r.update()}(e)}}function K(e){!1!==r.enabled&&(document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",K,!1),r.dispatchEvent(h),d=u.NONE)}function Q(e){!1===r.enabled||!1===r.enableZoom||d!==u.NONE&&d!==u.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(l),function(e){e.deltaY<0?Y(L()):0<e.deltaY&&N(L()),r.update()}(e),r.dispatchEvent(h))}function W(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){var t=!1;switch(e.keyCode){case r.keys.UP:A(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:A(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:A(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:A(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function J(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===r.enableRotate)return;U(e),d=u.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===r.enablePan)return;X(e),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(r.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&Z(e),r.enablePan&&X(e)}(e),d=u.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&Z(e),r.enableRotate&&U(e)}(e),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&r.dispatchEvent(l)}}function $(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case u.TOUCH_ROTATE:if(!1===r.enableRotate)return;I(e),r.update();break;case u.TOUCH_PAN:if(!1===r.enablePan)return;_(e),r.update();break;case u.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&q(e),r.enablePan&&_(e)}(e),r.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&q(e),r.enableRotate&&I(e)}(e),r.update();break;default:d=u.NONE}}function ee(e){!1!==r.enabled&&(r.dispatchEvent(h),d=u.NONE)}function te(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",te,!1),r.domElement.addEventListener("mousedown",B,!1),r.domElement.addEventListener("wheel",Q,!1),r.domElement.addEventListener("touchstart",J,!1),r.domElement.addEventListener("touchend",ee,!1),r.domElement.addEventListener("touchmove",$,!1),r.domElement.addEventListener("keydown",W,!1),-1===r.domElement.tabIndex&&(r.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls,THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var s=this,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var o=new THREE.Vector3,n=1,r=a.NONE,i=a.NONE,c=new THREE.Vector3,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector3,d=0,m=new THREE.Vector2,p=new THREE.Vector2,E=0,v=0,f=new THREE.Vector2,g=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var b={type:"change"},R={type:"start"},T={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var w,y,H,O,k,P,L,M,j,S,V,D,C=(w=new THREE.Vector2,function(e,t){return w.set((e-s.screen.left)/s.screen.width,(t-s.screen.top)/s.screen.height),w}),x=(y=new THREE.Vector2,function(e,t){return y.set((e-.5*s.screen.width-s.screen.left)/(.5*s.screen.width),(s.screen.height+2*(s.screen.top-t))/s.screen.width),y});function A(e){!1!==s.enabled&&(window.removeEventListener("keydown",A),i===a.NONE&&(e.keyCode!==s.keys[a.ROTATE]||s.noRotate?e.keyCode!==s.keys[a.ZOOM]||s.noZoom?e.keyCode!==s.keys[a.PAN]||s.noPan||(i=a.PAN):i=a.ZOOM:i=a.ROTATE))}function N(){!1!==s.enabled&&(i=a.NONE,window.addEventListener("keydown",A,!1))}function Y(e){if(!1!==s.enabled){if(e.preventDefault(),e.stopPropagation(),r===a.NONE)switch(e.button){case s.mouseButtons.LEFT:r=a.ROTATE;break;case s.mouseButtons.MIDDLE:r=a.ZOOM;break;case s.mouseButtons.RIGHT:r=a.PAN;break;default:r=a.NONE}var t=i!==a.NONE?i:r;t!==a.ROTATE||s.noRotate?t!==a.ZOOM||s.noZoom?t!==a.PAN||s.noPan||(f.copy(C(e.pageX,e.pageY)),g.copy(f)):(m.copy(C(e.pageX,e.pageY)),p.copy(m)):(h.copy(x(e.pageX,e.pageY)),l.copy(h)),document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",z,!1),s.dispatchEvent(R)}}function F(e){if(!1!==s.enabled){e.preventDefault(),e.stopPropagation();var t=i!==a.NONE?i:r;t!==a.ROTATE||s.noRotate?t!==a.ZOOM||s.noZoom?t!==a.PAN||s.noPan||g.copy(C(e.pageX,e.pageY)):p.copy(C(e.pageX,e.pageY)):(l.copy(h),h.copy(x(e.pageX,e.pageY)))}}function z(e){!1!==s.enabled&&(e.preventDefault(),e.stopPropagation(),r=a.NONE,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",z),s.dispatchEvent(T))}function U(e){if(!1!==s.enabled&&!0!==s.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:m.y-=.025*e.deltaY;break;case 1:m.y-=.01*e.deltaY;break;default:m.y-=25e-5*e.deltaY}s.dispatchEvent(R),s.dispatchEvent(T)}}function X(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:r=a.TOUCH_ROTATE,h.copy(x(e.touches[0].pageX,e.touches[0].pageY)),l.copy(h);break;default:r=a.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;v=E=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(C(n,i)),g.copy(f)}s.dispatchEvent(R)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(h),h.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;v=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(C(n,i))}}function I(e){if(!1!==s.enabled){switch(e.touches.length){case 0:r=a.NONE;break;case 1:r=a.TOUCH_ROTATE,h.copy(x(e.touches[0].pageX,e.touches[0].pageY)),l.copy(h)}s.dispatchEvent(T)}}function _(e){!1!==s.enabled&&e.preventDefault()}this.rotateCamera=(O=new THREE.Vector3,k=new THREE.Quaternion,P=new THREE.Vector3,L=new THREE.Vector3,M=new THREE.Vector3,j=new THREE.Vector3,function(){j.set(h.x-l.x,h.y-l.y,0),(H=j.length())?(c.copy(s.object.position).sub(s.target),P.copy(c).normalize(),L.copy(s.object.up).normalize(),M.crossVectors(L,P).normalize(),L.setLength(h.y-l.y),M.setLength(h.x-l.x),j.copy(L.add(M)),O.crossVectors(j,c).normalize(),H*=s.rotateSpeed,k.setFromAxisAngle(O,H),c.applyQuaternion(k),s.object.up.applyQuaternion(k),u.copy(O),d=H):!s.staticMoving&&d&&(d*=Math.sqrt(1-s.dynamicDampingFactor),c.copy(s.object.position).sub(s.target),k.setFromAxisAngle(u,d),c.applyQuaternion(k),s.object.up.applyQuaternion(k)),l.copy(h)}),this.zoomCamera=function(){var e;r===a.TOUCH_ZOOM_PAN?(e=E/v,E=v,s.object.isPerspectiveCamera?c.multiplyScalar(e):s.object.isOrthographicCamera?(s.object.zoom*=e,s.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(p.y-m.y)*s.zoomSpeed)&&0<e&&(s.object.isPerspectiveCamera?c.multiplyScalar(e):s.object.isOrthographicCamera?(s.object.zoom/=e,s.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),s.staticMoving?m.copy(p):m.y+=(p.y-m.y)*this.dynamicDampingFactor)},this.panCamera=(S=new THREE.Vector2,V=new THREE.Vector3,D=new THREE.Vector3,function(){if(S.copy(g).sub(f),S.lengthSq()){if(s.object.isOrthographicCamera){var e=(s.object.right-s.object.left)/s.object.zoom/s.domElement.clientWidth,t=(s.object.top-s.object.bottom)/s.object.zoom/s.domElement.clientWidth;S.x*=e,S.y*=t}S.multiplyScalar(c.length()*s.panSpeed),D.copy(c).cross(s.object.up).setLength(S.x),D.add(V.copy(s.object.up).setLength(S.y)),s.object.position.add(D),s.target.add(D),s.staticMoving?f.copy(g):f.add(S.subVectors(g,f).multiplyScalar(s.dynamicDampingFactor))}}),this.checkDistances=function(){s.noZoom&&s.noPan||(c.lengthSq()>s.maxDistance*s.maxDistance&&(s.object.position.addVectors(s.target,c.setLength(s.maxDistance)),m.copy(p)),c.lengthSq()<s.minDistance*s.minDistance&&(s.object.position.addVectors(s.target,c.setLength(s.minDistance)),m.copy(p)))},this.update=function(){c.subVectors(s.object.position,s.target),s.noRotate||s.rotateCamera(),s.noZoom||s.zoomCamera(),s.noPan||s.panCamera(),s.object.position.addVectors(s.target,c),s.object.isPerspectiveCamera?(s.checkDistances(),s.object.lookAt(s.target),1e-6<o.distanceToSquared(s.object.position)&&(s.dispatchEvent(b),o.copy(s.object.position))):s.object.isOrthographicCamera?(s.object.lookAt(s.target),(1e-6<o.distanceToSquared(s.object.position)||n!==s.object.zoom)&&(s.dispatchEvent(b),o.copy(s.object.position),n=s.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){r=a.NONE,i=a.NONE,s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.up.copy(s.up0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),c.subVectors(s.object.position,s.target),s.object.lookAt(s.target),s.dispatchEvent(b),o.copy(s.object.position),n=s.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",_,!1),this.domElement.removeEventListener("mousedown",Y,!1),this.domElement.removeEventListener("wheel",U,!1),this.domElement.removeEventListener("touchstart",X,!1),this.domElement.removeEventListener("touchend",I,!1),this.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",z,!1),window.removeEventListener("keydown",A,!1),window.removeEventListener("keyup",N,!1)},this.domElement.addEventListener("contextmenu",_,!1),this.domElement.addEventListener("mousedown",Y,!1),this.domElement.addEventListener("wheel",U,!1),this.domElement.addEventListener("touchstart",X,!1),this.domElement.addEventListener("touchend",I,!1),this.domElement.addEventListener("touchmove",Z,!1),window.addEventListener("keydown",A,!1),window.addEventListener("keyup",N,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.VRControls=function(o,n){var i,s=this,a=new THREE.Matrix4;function e(e){for(var t=0;t<e.length;t++)if("VRDisplay"in window&&e[t]instanceof VRDisplay||"PositionSensorVRDevice"in window&&e[t]instanceof PositionSensorVRDevice){i=e[t];break}i||n&&n("VR input not available.")}navigator.getVRDisplays?navigator.getVRDisplays().then(e):navigator.getVRDevices&&navigator.getVRDevices().then(e),this.scale=1,this.standing=!1,this.userHeight=1.6,this.update=function(){if(i){if(i.getPose){var e=i.getPose();null!==e.orientation&&o.quaternion.fromArray(e.orientation),null!==e.position?o.position.fromArray(e.position):o.position.set(0,0,0)}else{var t=i.getState();null!==t.orientation&&o.quaternion.copy(t.orientation),null!==t.position?o.position.copy(t.position):o.position.set(0,0,0)}this.standing&&(i.stageParameters?(o.updateMatrix(),a.fromArray(i.stageParameters.sittingToStandingTransform),o.applyMatrix(a)):o.position.setY(o.position.y+this.userHeight)),o.position.multiplyScalar(s.scale)}},this.resetPose=function(){i&&(void 0!==i.resetPose?i.resetPose():void 0!==i.resetSensor?i.resetSensor():void 0!==i.zeroSensor&&i.zeroSensor())},this.resetSensor=function(){console.warn("THREE.VRControls: .resetSensor() is now .resetPose()."),this.resetPose()},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetPose()."),this.resetPose()},this.dispose=function(){i=null}},THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new Stats,o=t.domElement.style;o.position="absolute",o.top=o.left=0,e.element.appendChild(t.domElement),e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement),delete e.stats},pre:function(e,t){this.stats.begin()},post:function(e,t){this.stats.end()}}),THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null,this._camera=e.camera||new THREE.PerspectiveCamera,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.options.klass?(e&&!e.changes.klass||(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),_.extend(t.controls,this.options.parameters)):t.controls=null},update:function(e,t){var o=t.Time&&t.Time.delta||1/60,n=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(n),t.controls.update(o)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}}),THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(e){this.timeout=this.options.timeout,this.element=e.element,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(e,t){var o=t.Time&&t.Time.delta||1/60;this.options.hide&&(this.timeout-=o,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(e,t){this.hide=e.active&&!e.hmd.fake,this.applyCursor(t)},applyCursor:function(e,t){var o=e.controls?"move":"";t=t||this.options.cursor||o,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}}),THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){this.options.key&&e.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}.bind(this));var o=function(){var e=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);t.Fullscreen.active=this.active=e,t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1)},toggle:function(e){var t=e.canvas,o=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(o):t.msRequestFullScreen?t.msRequestFullscreen(o):t.webkitRequestFullscreen?t.webkitRequestFullscreen(o):t.mozRequestFullScreen&&t.mozRequestFullScreen(o)}}),THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(e){e.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(s,a,r){return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:function(e){return{left:{x:-.03,y:0,z:0},right:{x:.03,y:0,z:0}}[e]},getRecommendedEyeFieldOfView:function(e){var t=s.camera,o=t&&t.aspect||16/9,n=(a||t&&t.fov||r)/2,i=180*Math.atan(Math.tan(n*Math.PI/180)*o/2)/Math.PI;return{left:{rightDegrees:i,leftDegrees:i,downDegrees:n,upDegrees:n},right:{rightDegrees:i,leftDegrees:i,downDegrees:n,upDegrees:n}}[e]}},{force:2,getState:function(){return{}}}]},load:function(e,t){var o=function(e){this.callback(e,t)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(o):navigator.mozGetVRDevices?navigator.mozGetVRDevices(o):(console.warn("No native VR support detected."),o(this.mocks(t,this.options.fov,this.defaults.fov),t))},callback:function(e,t){var o,n,i=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;for(var a=this.options.device,r=0;r<e.length;++r){if(1==(c=e[r]).force||c instanceof i){if(a&&a!=c.deviceId)continue;o=c;break}}if(o){for(r=0;r<e.length;++r){var c;if(2==(c=e[r]).force||c instanceof s&&c.hardwareUnitId==o.hardwareUnitId){n=c;break}}this.hookup(o,n,t)}},hookup:function(e,t,o){THREE.VRRenderer||console.log("THREE.VRRenderer not found");var n=THREE.VRRenderer||function(){};this.renderer=new n(o.renderer,e),this.hmd=e,this.sensor=t,o.VR.renderer=this.renderer,o.VR.hmd=e,o.VR.sensor=t,console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){e.changes.device&&this.callback(null,t),this.pre(e,t)},pre:function(e,t){var o=this.active,n=this.active=this.renderer&&"2d"!=this.options.mode;if((t.VR.active=n)&&this.sensor){var i=this.sensor.getState();t.VR.state=i}else t.VR.state=null;o!=this.active&&t.trigger({type:"vr",active:n,hmd:this.hmd,sensor:this.sensor})},resize:function(e,t){this.active&&this.renderer.initialize()},render:function(e,t){if(t.scene&&t.camera){var o=this.active?this.renderer:t.renderer;if(this.last!=o&&o==t.renderer){var n=o.getPixelRatio(),i=o.domElement.width/n,s=o.domElement.height/n;o.setScissorTest(!1),o.setViewport(0,0,i,s)}(this.last=o).render(t.scene,t.camera)}}}),THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,o){var n="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(n="http://"+n);var i=[];return e.Fullscreen&&i.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),e.VR&&i.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+n+'"); '+o+'</style><div class="threestrap-ui threestrap-'+t+'">'+i.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style),document.body.appendChild(t);var o=this.ui.fullscreen=t.querySelector("button.fullscreen");o&&e.bind([o,"click:goFullscreen"],this);var n=this.ui.vr=t.querySelector("button.vr");n&&e.VR&&(e.VR.set({mode:"2d"}),e.bind([n,"click:goVR"],this))},uninstall:function(e){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block",e.active||t.VR&&t.VR.set({mode:"2d"})},goFullscreen:function(e,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(e,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(e){document.body.removeChild(this.ui)}});